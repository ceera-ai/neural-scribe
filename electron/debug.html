<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug Tools - Neural Scribe</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0a0a0f 0%, #1a1a24 100%);
      color: #e0e0e0;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    h1 {
      font-size: 1.5rem;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #00ffff 0%, #ff00ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 0.875rem;
      color: #a0a0a0;
      margin-bottom: 30px;
    }

    .section {
      background: rgba(26, 26, 36, 0.8);
      border: 1px solid rgba(0, 255, 255, 0.2);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: #00ffff;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    button {
      padding: 10px 20px;
      background: linear-gradient(135deg, #00ffff 0%, #ff00ff 100%);
      border: none;
      border-radius: 6px;
      color: #0a0a0f;
      font-weight: 600;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .log {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(0, 255, 255, 0.1);
      border-radius: 6px;
      padding: 15px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 0.75rem;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 15px;
      color: #00ff88;
    }

    .log-entry {
      margin-bottom: 5px;
      padding: 2px 0;
    }

    .log-success {
      color: #00ff88;
    }

    .log-error {
      color: #ff0088;
    }

    .log-info {
      color: #00ffff;
    }

    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      align-items: center;
    }

    input,
    select {
      flex: 1;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(0, 255, 255, 0.3);
      border-radius: 6px;
      color: #e0e0e0;
      font-size: 0.875rem;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: #00ffff;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }

    select {
      cursor: pointer;
    }

    select option {
      background: #1a1a24;
      color: #e0e0e0;
    }

    label {
      font-size: 0.875rem;
      color: #a0a0a0;
      min-width: 120px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üõ†Ô∏è Debug Tools</h1>
    <p class="subtitle">Development utilities for testing Neural Scribe</p>

    <!-- Achievement Testing -->
    <div class="section">
      <h2 class="section-title">Achievement Testing</h2>

      <div class="input-group">
        <label for="achievement-id">Achievement ID:</label>
        <select id="achievement-id">
          <option value="">Loading...</option>
        </select>
      </div>

      <div class="button-group">
        <button onclick="resetAchievement()">Reset Achievement</button>
        <button onclick="unlockAchievement()">Force Unlock</button>
        <button onclick="checkAllAchievements()">Check All Achievements</button>
      </div>

      <div class="log" id="achievement-log"></div>
    </div>

    <!-- Gamification Data -->
    <div class="section">
      <h2 class="section-title">Gamification Data</h2>

      <div class="button-group">
        <button onclick="viewStats()">View Stats</button>
        <button onclick="resetProgress()">Reset All Progress</button>
      </div>

      <div class="log" id="gamification-log"></div>
    </div>
  </div>

  <script>
    // Load achievements on page load
    async function loadAchievements() {
      try {
        const achievements = await window.electronAPI.getAchievementDefinitions()
        const select = document.getElementById('achievement-id')

        // Clear loading option
        select.innerHTML = ''

        // Group achievements by category
        const categories = {}
        achievements.forEach(achievement => {
          if (!categories[achievement.category]) {
            categories[achievement.category] = []
          }
          categories[achievement.category].push(achievement)
        })

        // Add options grouped by category
        Object.keys(categories).sort().forEach(category => {
          const optgroup = document.createElement('optgroup')
          optgroup.label = category.charAt(0).toUpperCase() + category.slice(1).replace('-', ' ')

          categories[category]
            .sort((a, b) => a.order - b.order)
            .forEach(achievement => {
              const option = document.createElement('option')
              option.value = achievement.id
              option.textContent = `${achievement.icon} ${achievement.name} (${achievement.id})`
              optgroup.appendChild(option)
            })

          select.appendChild(optgroup)
        })

        // Set default to microphone-selector if it exists
        if (achievements.find(a => a.id === 'microphone-selector')) {
          select.value = 'microphone-selector'
        }
      } catch (error) {
        console.error('Failed to load achievements:', error)
        const select = document.getElementById('achievement-id')
        select.innerHTML = '<option value="">Error loading achievements</option>'
      }
    }

    // Load achievements when page loads
    window.addEventListener('DOMContentLoaded', loadAchievements)

    // Logging utilities
    function log(message, type = 'info', logId = 'achievement-log') {
      const logEl = document.getElementById(logId)
      const entry = document.createElement('div')
      entry.className = `log-entry log-${type}`
      const timestamp = new Date().toLocaleTimeString()
      entry.textContent = `[${timestamp}] ${message}`
      logEl.appendChild(entry)
      logEl.scrollTop = logEl.scrollHeight
    }

    function clearLog(logId = 'achievement-log') {
      document.getElementById(logId).innerHTML = ''
    }

    // Achievement Testing Functions
    async function resetAchievement() {
      const id = document.getElementById('achievement-id').value
      if (!id) {
        log('Please select an achievement', 'error')
        return
      }

      clearLog()
      log(`Resetting achievement: ${id}...`, 'info')

      try {
        const result = await window.electronAPI.resetAchievement(id)
        if (result.success) {
          if (result.wasUnlocked) {
            log(`‚úÖ Achievement "${id}" has been reset and locked`, 'success')
          } else {
            log(`‚ÑπÔ∏è  Achievement "${id}" was not unlocked`, 'info')
          }
        } else {
          log(`‚ùå Failed to reset achievement`, 'error')
        }
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error')
      }
    }

    async function unlockAchievement() {
      const id = document.getElementById('achievement-id').value
      if (!id) {
        log('Please select an achievement', 'error')
        return
      }

      clearLog()
      log(`Force unlocking achievement: ${id}...`, 'info')

      try {
        await window.electronAPI.unlockGamificationAchievement({
          achievementId: id,
          xpReward: 50
        })
        log(`‚úÖ Achievement "${id}" unlocked`, 'success')
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error')
      }
    }

    async function checkAllAchievements() {
      clearLog()
      log('Checking all achievements...', 'info')

      try {
        const unlockedIds = await window.electronAPI.checkAndUnlockAllAchievements()
        if (unlockedIds.length > 0) {
          log(`‚úÖ Unlocked ${unlockedIds.length} achievement(s):`, 'success')
          unlockedIds.forEach(id => log(`   - ${id}`, 'success'))
        } else {
          log('‚ÑπÔ∏è  No new achievements to unlock', 'info')
        }
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error')
      }
    }

    // Gamification Data Functions
    async function viewStats() {
      clearLog('gamification-log')
      log('Loading stats...', 'info', 'gamification-log')

      try {
        const data = await window.electronAPI.getGamificationData()

        log(`Level: ${data.level.level} (${data.level.rank})`, 'success', 'gamification-log')
        log(`XP: ${data.level.currentXP} / ${data.level.totalXPForNextLevel}`, 'success', 'gamification-log')
        log(`Sessions: ${data.stats.totalSessions}`, 'info', 'gamification-log')
        log(`Words: ${data.stats.totalWordsTranscribed}`, 'info', 'gamification-log')
        log(`Streak: ${data.stats.currentStreak} days`, 'info', 'gamification-log')

        if (data.stats.featureUsage) {
          log('--- Feature Usage ---', 'info', 'gamification-log')
          log(`Formatting: ${data.stats.featureUsage.formattingOperations}`, 'info', 'gamification-log')
          log(`Terminal Pastes: ${data.stats.featureUsage.terminalPasteOperations}`, 'info', 'gamification-log')
          log(`Voice Commands: ${data.stats.featureUsage.voiceCommandsUsed}`, 'info', 'gamification-log')
          log(`Microphone Changes: ${data.stats.featureUsage.microphoneChanges || 0}`, 'info', 'gamification-log')
        }

        const unlockedCount = Object.keys(data.achievements.unlocked).length
        log(`Achievements: ${unlockedCount} unlocked`, 'success', 'gamification-log')
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error', 'gamification-log')
      }
    }

    async function resetProgress() {
      if (!confirm('Are you sure you want to reset ALL gamification progress? This cannot be undone!')) {
        return
      }

      clearLog('gamification-log')
      log('Resetting all progress...', 'info', 'gamification-log')

      try {
        await window.electronAPI.resetGamificationProgress()
        log('‚úÖ All progress has been reset', 'success', 'gamification-log')
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error', 'gamification-log')
      }
    }
  </script>
</body>
</html>
